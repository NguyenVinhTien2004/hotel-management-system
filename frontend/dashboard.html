<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Kh√°ch s·∫°n Cocotier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="animations.css">
    <link rel="stylesheet" href="cocotier-logo-image.css">
</head>
<body class="bg-gray-100">
    <nav class="bg-white shadow-sm border-b animate-slide-in-down">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="cocotier-logo-img animate-fade-in delay-100">
                        <div class="logo-temp logo-temp-large"></div>
                        <span class="logo-text-img logo-text-img-large">COCOTIER</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="userName" class="text-gray-700 animate-fade-in delay-300"></span>
                    <button onclick="logout()" class="text-red-600 hover:text-red-700 smooth-transition btn-hover-scale">ƒêƒÉng xu·∫•t</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div class="px-4 py-6 sm:px-0">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white overflow-hidden shadow rounded-lg card-hover animate-fade-in delay-100">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white float">üìÖ</div>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">ƒê·∫∑t ph√≤ng c·ªßa t√¥i</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="myBookings" data-stat="my-bookings">0</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg card-hover animate-fade-in delay-200">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white float">üè®</div>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">Ph√≤ng tr·ªëng</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="availableRooms" data-stat="available-rooms">0</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg card-hover animate-fade-in delay-300">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center text-white float">‚≠ê</div>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">ƒê√°nh gi√° c·ªßa t√¥i</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="myFeedbacks" data-stat="my-feedbacks">0</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg card-hover animate-fade-in delay-400">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white float">üõéÔ∏è</div>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">D·ªãch v·ª• c√≥ s·∫µn</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="totalServices" data-stat="services">0</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <div class="bg-white shadow rounded-lg p-6 animate-slide-in-up delay-500">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Menu ch·ª©c nƒÉng</h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <a href="room-list.html" class="stagger-item flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 card-hover smooth-transition">
                                <div class="w-12 h-12 bg-indigo-500 rounded-full flex items-center justify-center text-white mb-2 btn-hover-scale">üëÅÔ∏è</div>
                                <span class="text-sm font-medium">Xem ph√≤ng</span>
                            </a>
                            <a href="bookings.html" class="stagger-item flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 card-hover smooth-transition">
                                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white mb-2 btn-hover-scale">üìÖ</div>
                                <span class="text-sm font-medium">ƒê·∫∑t ph√≤ng</span>
                            </a>
                            <a href="booking-history.html" class="stagger-item flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 card-hover smooth-transition">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white mb-2 btn-hover-scale">üìã</div>
                                <span class="text-sm font-medium">L·ªãch s·ª≠ ƒë·∫∑t ph√≤ng</span>
                            </a>
                            <a href="feedback.html" class="stagger-item flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 card-hover smooth-transition">
                                <div class="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center text-white mb-2 btn-hover-scale">‚≠ê</div>
                                <span class="text-sm font-medium">ƒê√°nh gi√° d·ªãch v·ª•</span>
                            </a>
                            <a href="customer-services.html" class="stagger-item flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 card-hover smooth-transition">
                                <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white mb-2 btn-hover-scale">üõéÔ∏è</div>
                                <span class="text-sm font-medium">D·ªãch v·ª• kh√°ch s·∫°n</span>
                            </a>
                            <a href="profile.html" class="stagger-item flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 card-hover smooth-transition">
                                <div class="w-12 h-12 bg-gray-500 rounded-full flex items-center justify-center text-white mb-2 btn-hover-scale">üë§</div>
                                <span class="text-sm font-medium">T√†i kho·∫£n c·ªßa t√¥i</span>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="bg-white shadow rounded-lg p-6 animate-slide-in-up delay-600">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h3>
                    <div id="recentActivities" class="space-y-3">
                        <!-- Activities will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Room Detail Modal -->
    <div id="roomDetailModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
                <!-- Room Image -->
                <div class="relative h-64 bg-gradient-to-br from-gray-300 to-gray-400" id="roomDetailImage">
                    <div class="absolute top-4 left-4 right-4 flex justify-between items-center">
                        <button onclick="hideRoomDetailModal()" class="w-10 h-10 bg-white bg-opacity-90 rounded-full flex items-center justify-center hover:bg-opacity-100 transition-all">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                        <button class="w-10 h-10 bg-white bg-opacity-90 rounded-full flex items-center justify-center hover:bg-opacity-100 transition-all">
                            <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="absolute bottom-4 left-4 text-white">
                        <h2 class="text-2xl font-bold" id="roomDetailName">T√™n ph√≤ng</h2>
                        <p class="text-lg font-semibold" id="roomDetailPrice">‚Ç´0/night</p>
                    </div>
                    <div class="absolute bottom-4 right-4 bg-white bg-opacity-90 rounded-full px-3 py-1">
                        <span class="text-sm font-medium text-gray-800" id="roomDetailRating">8+</span>
                    </div>
                </div>

                <!-- Room Info -->
                <div class="p-6">
                    <!-- Distance and Rating -->
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center text-sm text-gray-600">
                            <div class="w-4 h-4 bg-red-500 rounded-full mr-2"></div>
                            <span id="roomDetailDistance">Trung t√¢m th√†nh ph·ªë</span>
                        </div>
                        <div class="flex items-center">
                            <svg class="w-4 h-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                            <span class="text-sm font-medium" id="roomDetailStarRating">4.8</span>
                            <span class="text-sm text-gray-500 ml-1">Ratings</span>
                        </div>
                    </div>

                    <!-- What this place offers -->
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-semibold text-gray-900">Ti·ªán √≠ch ph√≤ng</h3>
                            <button class="text-blue-600 text-sm font-medium">Xem t·∫•t c·∫£</button>
                        </div>
                        <div class="grid grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
                                    </svg>
                                </div>
                                <span class="text-xs text-gray-600">WiFi</span>
                            </div>
                            <div class="text-center">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                    </svg>
                                </div>
                                <span class="text-xs text-gray-600">Clinic</span>
                            </div>
                            <div class="text-center">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                    </svg>
                                </div>
                                <span class="text-xs text-gray-600">Park</span>
                            </div>
                            <div class="text-center">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                </div>
                                <span class="text-xs text-gray-600">Pool</span>
                            </div>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">M√¥ t·∫£</h3>
                        <p class="text-gray-600 text-sm leading-relaxed" id="roomDetailDescription">
                            Ph√≤ng tho·∫£i m√°i v·ªõi thi·∫øt k·∫ø hi·ªán ƒë·∫°i v√† ƒë·∫ßy ƒë·ªß ti·ªán nghi.
                        </p>
                    </div>

                    <!-- Book Now Button -->
                    <button onclick="bookRoomFromModal()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-semibold text-lg hover:bg-blue-700 transition-colors">
                        Book Now
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/cache-manager.js"></script>
    <script>
        const API_URL = AppConfig.getApiUrl();
        
        function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'index.html';
                return;
            }
            
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            document.getElementById('userName').textContent = user.name || 'Kh√°ch h√†ng';
        }
        
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }
        
        async function loadDashboardData() {
            const token = localStorage.getItem('token');
            try {
                // Use cache manager for fetching
                const response = await CacheManager.fetchWithCacheBusting(`${API_URL}/dashboard/stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('availableRooms').textContent = data.availableRooms || 0;
                    document.getElementById('totalServices').textContent = data.totalServices || 0;
                    document.getElementById('myBookings').textContent = data.myBookings || 0;
                    document.getElementById('myFeedbacks').textContent = data.myFeedbacks || 0;
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
        
        async function loadRecentActivities() {
            const token = localStorage.getItem('token');
            try {
                const response = await CacheManager.fetchWithCacheBusting(`${API_URL}/dashboard/activities`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayRecentActivities(data.activities || []);
                }
            } catch (error) {
                console.error('Error loading activities:', error);
                displayRecentActivities([]);
            }
        }
        
        function displayRecentActivities(activities) {
            const container = document.getElementById('recentActivities');
            
            if (activities.length === 0) {
                // Hi·ªÉn th·ªã ho·∫°t ƒë·ªông m·∫´u
                const sampleActivities = [
                    {
                        icon: 'üìÖ',
                        title: 'Ch√†o m·ª´ng b·∫°n!',
                        description: 'H√£y b·∫Øt ƒë·∫ßu b·∫±ng vi·ªác ƒë·∫∑t ph√≤ng ƒë·∫ßu ti√™n',
                        time: new Date().toISOString(),
                        status: 'info'
                    },
                    {
                        icon: 'üè®',
                        title: 'Kh√°m ph√° ph√≤ng',
                        description: 'Xem danh s√°ch ph√≤ng c√≥ s·∫µn',
                        time: new Date().toISOString(),
                        status: 'info'
                    }
                ];
                
                container.innerHTML = sampleActivities.map(activity => {
                    const statusColor = getActivityStatusColor(activity.status);
                    
                    return `
                        <div class="flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-md">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 ${statusColor} rounded-full flex items-center justify-center text-white text-sm">
                                    ${activity.icon}
                                </div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-gray-900">${activity.title}</p>
                                <p class="text-xs text-gray-500">${activity.description}</p>
                                <p class="text-xs text-gray-400 mt-1">V·ª´a x√¥ng</p>
                            </div>
                        </div>
                    `;
                }).join('');
                return;
            }
            
            container.innerHTML = activities.map(activity => {
                const timeAgo = getTimeAgo(activity.time);
                const statusColor = getActivityStatusColor(activity.status);
                
                return `
                    <div class="flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-md">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 ${statusColor} rounded-full flex items-center justify-center text-white text-sm">
                                ${activity.icon}
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900">${activity.title}</p>
                            <p class="text-xs text-gray-500">${activity.description}</p>
                            <p class="text-xs text-gray-400 mt-1">${timeAgo}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getActivityStatusColor(status) {
            switch(status) {
                case 'pending': return 'bg-yellow-500';
                case 'confirmed': return 'bg-green-500';
                case 'checked_in': return 'bg-blue-500';
                case 'checked_out': return 'bg-gray-500';
                case 'cancelled': return 'bg-red-500';
                case 'completed': return 'bg-purple-500';
                case 'info': return 'bg-indigo-500';
                default: return 'bg-gray-400';
            }
        }
        
        function getTimeAgo(dateString) {
            const now = new Date();
            const date = new Date(dateString);
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'V·ª´a x√¥ng';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} ph√∫t tr∆∞·ªõc`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} gi·ªù tr∆∞·ªõc`;
            if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)} ng√†y tr∆∞·ªõc`;
            return date.toLocaleDateString('vi-VN');
        }
        
        checkAuth();
        loadDashboardData();
        loadRecentActivities();
        
        // Check if need to refresh after booking/feedback
        if (localStorage.getItem('refreshDashboard') === 'true') {
            localStorage.removeItem('refreshDashboard');
            // Immediate update
            loadDashboardData();
            loadRecentActivities();
        }
        
        // T·ª± ƒë·ªông refresh ho·∫°t ƒë·ªông m·ªói 10 gi√¢y
        setInterval(() => {
            loadRecentActivities();
            loadDashboardData();
        }, 10000);
        
        // Room Detail Modal Functions
        let currentModalRoom = null;
        
        function showRoomDetailModal(room) {
            currentModalRoom = room;
            
            // C·∫≠p nh·∫≠t th√¥ng tin trong modal
            document.getElementById('roomDetailName').textContent = room.name || room.type;
            document.getElementById('roomDetailPrice').textContent = '‚Ç´' + room.price.toLocaleString('vi-VN') + '/night';
            document.getElementById('roomDetailRating').textContent = Math.floor(Math.random() * 3 + 8) + '+';
            document.getElementById('roomDetailDistance').textContent = `${room.capacity} ng∆∞·ªùi ‚Ä¢ ${room.type}`;
            document.getElementById('roomDetailStarRating').textContent = '4.' + Math.floor(Math.random() * 9 + 1);
            
            // C·∫≠p nh·∫≠t m√¥ t·∫£
            let description = `Ph√≤ng ${room.type.toLowerCase()} tho·∫£i m√°i v·ªõi thi·∫øt k·∫ø hi·ªán ƒë·∫°i, ƒë·∫ßy ƒë·ªß ti·ªán nghi cao c·∫•p. Ph√π h·ª£p cho ${room.capacity} ng∆∞·ªùi l∆∞u tr√∫.`;
            if (room.description) {
                description = room.description;
            }
            document.getElementById('roomDetailDescription').textContent = description;
            
            // C·∫≠p nh·∫≠t h√¨nh ·∫£nh
            const imageElement = document.getElementById('roomDetailImage');
            if (room.image) {
                imageElement.style.backgroundImage = `url('${room.image}')`;
                imageElement.style.backgroundSize = 'cover';
                imageElement.style.backgroundPosition = 'center';
            } else {
                const gradients = {
                    'ƒê∆°n': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    'ƒê√¥i': 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                    'Gia ƒê√¨nh': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    'VIP': 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
                };
                imageElement.style.backgroundImage = gradients[room.type] || gradients['ƒê∆°n'];
            }
            
            // Hi·ªÉn th·ªã modal
            document.getElementById('roomDetailModal').classList.remove('hidden');
        }
        
        function hideRoomDetailModal() {
            document.getElementById('roomDetailModal').classList.add('hidden');
            currentModalRoom = null;
        }
        
        function bookRoomFromModal() {
            if (!currentModalRoom) {
                alert('Kh√¥ng c√≥ th√¥ng tin ph√≤ng');
                return;
            }
            
            localStorage.setItem('selectedRoom', JSON.stringify(currentModalRoom));
            window.location.href = 'bookings.html';
        }
        
        // ƒê√≥ng modal khi click b√™n ngo√†i
        document.getElementById('roomDetailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideRoomDetailModal();
            }
        });
    </script>
</body>
</html>
